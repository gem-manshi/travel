<div *ngIf="config" class="p-5">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li
        *ngFor="let breadCrumb of config.breadCrumbs; let last = last"
        class="d-flex align-items-center"
        [class.active]="last"
      >
        <a *ngIf="!last" [routerLink]="breadCrumb.link" class="crumb">
          {{ breadCrumb.title }}
        </a>
        <span *ngIf="last">{{ breadCrumb.title }}</span>

        <i
          *ngIf="!last"
          class="bi bi-chevron-right mx-2 text-muted"
          aria-hidden="true"
        ></i>
      </li>
    </ol>
  </nav>

  <div class="form-title mb-3">
    <h5>{{ config.title }}</h5>
  </div>
  <ng-container *ngFor="let section of config.sections">
    <section *ngIf="section.type === 'policyDetails'" class="section-card mb-3">
      <div class="card-header p-3">
        <div class="text-md font-medium section-header-css">
          {{ section.title }}
        </div>
      </div>
      <div class="form-section p-3 row align-items-end">
        <ng-container *ngFor="let field of section.fields">
          <div *ngIf="field.type !== 'button'" class="mb-3 col-4">
            <label class="text-sm required">{{ field.label }}</label>
            <ng-container [ngSwitch]="field.type">
              <input
                *ngSwitchCase="'input'"
                class="form-control"
                [type]="field.inputType"
                [placeholder]="field.placeholder"
              />
            </ng-container>
          </div>

          <div *ngIf="field.type === 'button'" class="mb-3 col-8 text-end">
            <button type="button" class="btn btn-outline btn-sm btn-css">
              <img
                *ngIf="field.icon"
                src="https://harshitagnihotrigemini.github.io/insillion-common-styles-fe-harshit/assets/images/add-certi.svg"
                class="me-1"
              />
              {{ field.label }}
            </button>
          </div>
        </ng-container>
      </div>
    </section>
  </ng-container>

  <ng-container *ngFor="let section of config.sections; let i = index">
    <section *ngIf="section.type === 'baseDetails'" class="section-card mb-3">
      <div
        class="card-header p-3 d-flex justify-content-between align-items-center"
        (click)="section.open = !section.open"
        style="cursor: pointer"
      >
        <div class="text-md font-medium section-header-css">
          {{ section.title }}
        </div>
        <span>
          <i
            class="bi"
            [ngClass]="section.open ? 'bi-chevron-up' : 'bi-chevron-down'"
          ></i>
        </span>
      </div>

      <div class="form-section p-3 row" *ngIf="section.open">
        <div
          *ngFor="let field of section.fields"
          [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
          class="mb-3"
        >
          <label class="text-sm required">{{ field.label }}</label>
          <div [ngSwitch]="field.type">
            <input
              *ngSwitchCase="'input'"
              class="form-control"
              [type]="field.inputType"
              [placeholder]="field.placeholder"
            />

            <div class="input-group" *ngSwitchCase="'datepicker'">
              <input
                type="text"
                class="form-control"
                [placeholder]="field.placeholder"
                bsDatepicker
                [(ngModel)]="selectedDate"
              />
              <!-- <img
                src="../../../assets/icons/calender-icon.svg"
                alt="calendar"
                class="calendar-icon"
              /> -->
            </div>

            <ng-select
              *ngSwitchCase="'select'"
              [items]="field.options"
              bindLabel="value"
              bindValue="key"
              [placeholder]="field.placeholder"
            >
            </ng-select>
          </div>
        </div>
      </div>
    </section>
  </ng-container>

  <ng-container *ngFor="let section of config.sections">
    <section
      *ngIf="section.type === 'departureDetails'"
      class="section-card mb-3"
    >
      <div
        class="card-header p-3 d-flex justify-content-between align-items-center"
        (click)="section.open = !section.open"
        style="cursor: pointer"
      >
        <div class="text-md font-medium section-header-css">
          {{ section.title }}
        </div>
        <span>
          <i
            class="bi"
            [ngClass]="section.open ? 'bi-chevron-up' : 'bi-chevron-down'"
          ></i>
        </span>
      </div>

      <div class="form-section p-3" *ngIf="section.open">
        <div
          *ngFor="let flight of departureFlights; let i = index"
          class="mb-4"
        >
          <div
            *ngIf="i > 0"
            class="d-flex justify-content-between align-items-center mb-2 pb-2"
          >
            <div class="sub-label">Connecting Flight {{ i }}</div>
            <button
              class="btn btn-link text-danger"
              type="button"
              (click)="removeFlight(i, 'departure')"
            >
              <i class="bi bi-dash-circle"></i> Remove
            </button>
          </div>

          <div class="row">
            <div
              *ngFor="let field of departureFields"
              [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
              class="mb-3"
            >
              <label class="text-sm required">{{ field.label }}</label>
              <ng-container [ngSwitch]="field.type">
                <input
                  *ngSwitchCase="'input'"
                  class="form-control"
                  [type]="field.inputType"
                  [placeholder]="field.placeholder"
                />
                <input
                  *ngSwitchCase="'datepicker'"
                  class="form-control"
                  [placeholder]="field.placeholder"
                  bsDatepicker
                />
                <ng-select
                  *ngSwitchCase="'select'"
                  [items]="field.options"
                  [placeholder]="field.placeholder"
                ></ng-select>
              </ng-container>
            </div>
          </div>
        </div>

        <div class="row add-style">
          <button
            type="button"
            class="btn btn-outline btn-sm mb-3 col-4"
            (click)="addFlight('departure')"
          >
            <i class="bi bi-plus-circle"></i> Add Connecting Flight
          </button>
        </div>

        <div class="form-check mb-3 return-css">
          <input
            type="checkbox"
            class="form-check-input"
            (change)="toggleReturnJourney($event)"
          />
          <label class="form-check-label">Return Journey</label>
        </div>

        <div *ngIf="returnJourneyEnabled">
          <div *ngFor="let flight of returnFlights; let j = index" class="mb-4">
            <div
              class="d-flex justify-content-between align-items-center mb-2 pb-2"
            >
              <div class="sub-label">Return Flight {{ j + 1 }}</div>
              <button
                *ngIf="j > 0"
                class="btn btn-link text-danger"
                type="button"
                (click)="removeFlight(j, 'return')"
              >
                <i class="bi bi-dash-circle"></i> Remove
              </button>
            </div>

            <div class="row">
              <div
                *ngFor="let field of returnFields"
                [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                class="mb-3"
              >
                <label class="text-sm required">{{ field.label }}</label>
                <ng-container [ngSwitch]="field.type">
                  <input
                    *ngSwitchCase="'input'"
                    class="form-control"
                    [type]="field.inputType"
                    [placeholder]="field.placeholder"
                  />
                  <input
                    *ngSwitchCase="'datepicker'"
                    class="form-control"
                    bsDatepicker
                  />
                  <ng-select
                    *ngSwitchCase="'select'"
                    [items]="field.options"
                    bindLabel="value"
                    bindValue="key"
                    [placeholder]="field.placeholder"
                    class="custom-select-wrapper"
                  ></ng-select>
                </ng-container>
              </div>
            </div>
          </div>

          <div class="row add-return-style">
            <button
              type="button"
              class="btn btn-outline btn-sm mb-3 col-4"
              (click)="addFlight('return')"
            >
              <i class="bi bi-plus-circle"></i> Add Return Flight
            </button>
          </div>
        </div>
      </div>
    </section>
  </ng-container>

  <ng-container *ngFor="let section of config.sections">
    <section
      *ngIf="section.type === 'insuredDetails'"
      class="section-card mb-4"
    >
      <div
        class="card-header p-3 d-flex justify-content-between align-items-center"
        (click)="section.open = !section.open"
        style="cursor: pointer"
      >
        <div class="text-md font-medium section-header-css">
          {{ section.title }}
        </div>
        <span>
          <i
            class="bi"
            [ngClass]="section.open ? 'bi-chevron-up' : 'bi-chevron-down'"
          ></i>
        </span>
      </div>

      <div class="form-section p-3" *ngIf="section.open">
        <div class="row">
          <div
            *ngFor="let field of section.fields"
            [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
            class="mb-1"
          >
            <label
              *ngIf="field.type !== 'label' && field.type !== 'button'"
              class="text-sm"
            >
              {{ field.label }}
            </label>
            <div
              class="stepper-check"
              [ngClass]="{ 'align-css': field.lessWidth }"
            >
              <ng-container [ngSwitch]="field.type">
                <div *ngSwitchCase="'checkbox'" class="d-flex gap-2">
                  <div
                    *ngFor="let opt of field.options"
                    class="form-check"
                    [ngClass]="{
                      'individual-check': opt.key === 'individual',
                    }"
                  >
                    <input
                      type="checkbox"
                      class="form-check-input"
                      [value]="opt.key"
                      [checked]="field.value?.includes(opt.key)"
                      (change)="onCheckboxChange($event, field, opt.key)"
                    />
                    <label class="form-check-label">{{ opt.value }}</label>
                  </div>
                </div>

                <div *ngSwitchCase="'stepper'" class="stepper-class">
                  <ng-container *ngIf="field.name === 'familyCount'">
                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-sm sign-css"
                      (click)="decrementFamily(section)"
                    >
                      −
                    </button>

                    <span class="counter-css">{{ field.value }}</span>

                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-sm sign-css"
                      (click)="incrementFamily(section)"
                    >
                      +
                    </button>
                  </ng-container>

                  <ng-container *ngIf="field.name === 'individualCount'">
                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-sm sign-css"
                      (click)="decrementIndividual(section)"
                    >
                      −
                    </button>

                    <span class="counter-css">{{ field.value }}</span>

                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-sm sign-css"
                      (click)="incrementIndividual(section)"
                    >
                      +
                    </button>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <div *ngIf="familyChecked && families.length > 0">
          <div *ngFor="let family of families; let i = index">
            <div class="mb-2">
              <div class="d-flex justify-content-between align-items-center">
                <div class="label-style">Family Details {{ i + 1 }}</div>
                <button
                  class="btn btn-link text-danger p-0"
                  type="button"
                  (click)="removeFamily(i, section)"
                >
                  <i class="bi bi-dash-circle"></i> Remove
                </button>
              </div>
              <div class="sublabel-style">
                Primary Insured Family {{ i + 1 }}
              </div>
            </div>

            <div class="row mb-3">
              <div class="d-flex gap-2">
                <ng-container *ngFor="let field of section.fields">
                  <button
                    *ngIf="
                      field.type === 'button' &&
                      (field.name === 'addSelf' ||
                        field.name === 'addSpouse' ||
                        field.name === 'addChild')
                    "
                    type="button"
                    class="btn btn-outline btn-sm col-4"
                    (click)="addPerson(field.name, i, true)"
                    [disabled]="
                      (field.name === 'addSelf' && addSelfClicked[i]) ||
                      (field.name === 'addSpouse' && addSpouseClicked[i]) ||
                      (field.name === 'addChild' && addChildClicked[i])
                    "
                  >
                    <i class="bi bi-plus-circle me-1"></i>
                    {{ field.label }}
                  </button>
                </ng-container>
              </div>
            </div>

            <div
              *ngFor="let person of personsFamily[i]; let j = index"
              class="mt-4"
            >
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="label-style">{{ person.label }} {{ j + 1 }}</h6>
                <button
                  class="btn btn-link text-danger"
                  type="button"
                  (click)="removePerson(i, j)"
                >
                  <i class="bi bi-dash-circle"></i> Remove
                </button>
              </div>

              <div class="row">
                <div
                  *ngFor="let field of section.personFields"
                  [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                  class="mb-3"
                >
                  <label class="text-sm required">{{ field.label }}</label>
                  <ng-container [ngSwitch]="field.type">
                    <input
                      *ngSwitchCase="'input'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      [type]="field.inputType"
                      [(ngModel)]="person.data[field.name]"
                    />
                    <input
                      *ngSwitchCase="'datepicker'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      bsDatepicker
                      [(ngModel)]="person.data[field.name]"
                    />
                    <ng-select
                      *ngSwitchCase="'select'"
                      [items]="field.options"
                      bindLabel="value"
                      bindValue="key"
                      [placeholder]="field.placeholder"
                      [(ngModel)]="person.data[field.name]"
                    ></ng-select>
                  </ng-container>
                </div>
              </div>

              <h6 class="mt-3 px-md">Nominee Details</h6>
              <div class="row">
                <div
                  *ngFor="let field of section.nomineeFields"
                  [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                  class="mb-3"
                >
                  <label
                    *ngIf="field.type !== 'checkbox'"
                    class="text-sm required"
                  >
                    {{ field.label }}
                  </label>
                  <ng-container [ngSwitch]="field.type">
                    <input
                      *ngSwitchCase="'input'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      [type]="field.inputType"
                      [(ngModel)]="person.data[field.name]"
                    />
                    <input
                      *ngSwitchCase="'datepicker'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      bsDatepicker
                      [(ngModel)]="person.data[field.name]"
                    />
                    <ng-select
                      *ngSwitchCase="'select'"
                      [items]="field.options"
                      bindLabel="value"
                      bindValue="key"
                      [placeholder]="field.placeholder"
                      [(ngModel)]="person.data[field.name]"
                      class="custom-select-wrapper"
                    ></ng-select>
                    <ng-container *ngSwitchCase="'checkbox'">
                      <div *ngIf="person.label !== 'Self'" class="form-check">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          [(ngModel)]="person.data[field.name]"
                        />
                        <label class="form-check-label">{{
                          field.label
                        }}</label>
                      </div>
                    </ng-container>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="person.label === 'Child'" class="mt-2">
                <button
                  type="button"
                  class="btn btn-notOutline btn-sm"
                  (click)="addChildToFamily(i)"
                >
                  <i class="bi bi-plus-circle me-1"></i>
                  Add Child
                </button>
              </div>
            </div>
          </div>
        </div>
        <div
          class="mt-3 insured-style"
          *ngIf="familyChecked && families.length > 0"
        >
          <ng-container *ngFor="let field of section.fields">
            <button
              *ngIf="field.type === 'button' && field.name === 'addMoreInsured'"
              type="button"
              class="btn btn-outline btn-sm col-4 insured-style"
              (click)="addMoreInsured(section)"
              [disabled]="field.value >= field.max"
            >
              <i class="bi bi-plus-circle me-1"></i>
              {{ field.label }}
            </button>
          </ng-container>
        </div>

        <div *ngIf="individualChecked">
          <div
            *ngFor="let person of personsIndividual; let i = index"
            class="mt-4"
          >
            <div class="mb-2">
              <div class="d-flex justify-content-between align-items-center">
                <div class="label-style">Individual {{ i + 1 }}</div>

                <button
                  class="btn btn-link text-danger"
                  type="button"
                  (click)="removeIndividual(i, section)"
                >
                  <i class="bi bi-dash-circle"></i> Remove
                </button>
              </div>

              <div class="sublabel-style">{{ person.label }} {{ i + 1 }}</div>
            </div>

            <div class="row">
              <div
                *ngFor="let field of section.personFields"
                [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                class="mb-3"
              >
                <label class="text-sm required">{{ field.label }}</label>
                <ng-container [ngSwitch]="field.type">
                  <input
                    *ngSwitchCase="'input'"
                    [placeholder]="field.placeholder"
                    class="form-control"
                    [type]="field.inputType"
                    [(ngModel)]="person.data[field.name]"
                  />
                  <input
                    *ngSwitchCase="'datepicker'"
                    [placeholder]="field.placeholder"
                    class="form-control"
                    bsDatepicker
                    [(ngModel)]="person.data[field.name]"
                  />
                  <ng-select
                    *ngSwitchCase="'select'"
                    [items]="field.options"
                    bindLabel="value"
                    bindValue="key"
                    [placeholder]="field.placeholder"
                    [(ngModel)]="person.data[field.name]"
                    class="custom-select-wrapper"
                  ></ng-select>
                </ng-container>
              </div>
            </div>

            <h6 class="mt-3 px-md">Nominee Details</h6>
            <div class="row">
              <div
                *ngFor="let field of section.nomineeFields"
                [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                class="mb-3"
              >
                <label *ngIf="field.type !== 'checkbox'" class="text-sm">
                  {{ field.label }}
                </label>
                <ng-container [ngSwitch]="field.type">
                  <input
                    *ngSwitchCase="'input'"
                    [placeholder]="field.placeholder"
                    class="form-control"
                    [type]="field.inputType"
                    [(ngModel)]="person.data[field.name]"
                  />
                  <input
                    *ngSwitchCase="'datepicker'"
                    [placeholder]="field.placeholder"
                    class="form-control"
                    bsDatepicker
                    [(ngModel)]="person.data[field.name]"
                  />
                  <ng-select
                    *ngSwitchCase="'select'"
                    [items]="field.options"
                    bindLabel="value"
                    bindValue="key"
                    [placeholder]="field.placeholder"
                    [(ngModel)]="person.data[field.name]"
                    class="custom-select-wrapper"
                  ></ng-select>
                </ng-container>
              </div>
            </div>

            <div class="d-flex gap-2 mb-3 px-md">
              <button
                type="button"
                class="btn btn-outline btn-sm"
                (click)="addPerson('addSpouse', i, false)"
                [disabled]="hasSpouse(person)"
              >
                <i class="bi bi-plus-circle me-1"></i> Add Spouse
              </button>
              <button
                type="button"
                class="btn btn-outline btn-sm"
                (click)="addPerson('addChild', i, false)"
              >
                <i class="bi bi-plus-circle me-1"></i> Add Child
              </button>
            </div>

            <div
              *ngFor="let member of person.members; let j = index"
              class="mt-3"
            >
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="label-style">{{ member.label }}</h6>
                <button
                  class="btn btn-link text-danger"
                  type="button"
                  (click)="person.members.splice(j, 1)"
                >
                  <i class="bi bi-dash-circle"></i> Remove
                </button>
              </div>
              <div class="row">
                <div
                  *ngFor="let field of section.personFields"
                  [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                  class="mb-3"
                >
                  <label class="text-sm required">{{ field.label }}</label>
                  <ng-container [ngSwitch]="field.type">
                    <input
                      *ngSwitchCase="'input'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      [type]="field.inputType"
                      [(ngModel)]="member.data[field.name]"
                    />
                    <input
                      *ngSwitchCase="'datepicker'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      bsDatepicker
                      [(ngModel)]="member.data[field.name]"
                    />
                    <ng-select
                      *ngSwitchCase="'select'"
                      [items]="field.options"
                      bindLabel="value"
                      bindValue="key"
                      [placeholder]="field.placeholder"
                      [(ngModel)]="member.data[field.name]"
                    ></ng-select>
                  </ng-container>
                </div>
              </div>

              <h6 class="mt-3 px-md">Nominee Details</h6>
              <div class="row">
                <div
                  *ngFor="let field of section.nomineeFields"
                  [ngClass]="field.fullWidth ? 'col-12' : 'col-4'"
                  class="mb-3"
                >
                  <label *ngIf="field.type !== 'checkbox'" class="text-sm">
                    {{ field.label }}
                  </label>
                  <ng-container [ngSwitch]="field.type">
                    <input
                      *ngSwitchCase="'input'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      [type]="field.inputType"
                      [(ngModel)]="member.data[field.name]"
                    />
                    <input
                      *ngSwitchCase="'datepicker'"
                      [placeholder]="field.placeholder"
                      class="form-control"
                      bsDatepicker
                      [(ngModel)]="member.data[field.name]"
                    />
                    <ng-select
                      *ngSwitchCase="'select'"
                      [items]="field.options"
                      bindLabel="value"
                      bindValue="key"
                      [placeholder]="field.placeholder"
                      [(ngModel)]="member.data[field.name]"
                      class="custom-select-wrapper"
                    ></ng-select>
                  </ng-container>
                </div>
              </div>

              <div class="d-flex gap-2 mb-3 px-md">
                <button
                  type="button"
                  class="btn btn-outline btn-sm"
                  (click)="addPerson('addSpouse', i, false)"
                  [disabled]="hasSpouse(person)"
                >
                  <i class="bi bi-plus-circle me-1"></i> Add Spouse
                </button>
                <button
                  type="button"
                  class="btn btn-outline btn-sm"
                  (click)="addPerson('addChild', i, false)"
                >
                  <i class="bi bi-plus-circle me-1"></i> Add Child
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </ng-container>
</div>
<footer
  footer
  class="sticky-bottom bg-white mt-4 d-flex flex-column align-items-start gap-3 mx-auto bg-white"
  style="
    z-index: 1050;
    background: #fff;
    display: flex;
    align-items: flex-start;
    box-shadow: 0 -2px 8px 0 rgba(0, 0, 0, 0.08);
  "
>
  <div
    class="container d-flex flex-wrap justify-content-between align-items-center"
  >
    <div class="d-flex flex-wrap gap-3 flex-grow-1" style="padding: 16px">
      <button
        *ngIf="!getPremiumClicked"
        class="btn btn-primary btn-md flex-grow-1"
        type="button"
        style="min-width: 150px; max-width: 230px"
        (click)="onGetPremiumClick()"
      >
        Get Premium
      </button>
      <button
        *ngIf="getPremiumClicked"
        class="btn btn-primary btn-md flex-grow-1"
        type="button"
        style="min-width: 150px; max-width: 230px"
        (click)="goToPolicySummary()"
      >
        Next
      </button>
    </div>
    <div
      *ngIf="getPremiumClicked"
      class="summary d-flex align-items-center justify-content-start flex-shrink-0 ml-auto"
      style="margin-right: -12px"
    >
      <div class="d-flex flex-column">
        <span class="text-h3-semibold pb-md mt-xxl mb-xl">Total Premium</span>
        <a
          class="text-primary mt-1 small text-decoration-underline"
          style="margin: 0"
        >
          View Breakup
        </a>
      </div>
      <div style="border-left: 3px solid #8cb8ff; height: 40px"></div>
      <span class="text-h3-semibold pb-md mt-xxl mb-xl" style="margin-left: 0">
        ₹ 12,54,200.70
      </span>
    </div>
  </div>
</footer>
